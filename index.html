<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gnostic Sigil Pareidolia</title>
  <style>
    body {
      margin: 0;
      background: #0b0b0f;
      overflow: hidden;
      font-family: 'Courier New', Courier, monospace;
    }

    .grid {
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      display: grid;
      grid-template-columns: repeat(40, 1fr);
      grid-template-rows: repeat(30, 1fr);
      font-size: 0.85rem;
    }

    .cell {
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
      color: #eaeaea;
      transition: color 0.8s ease;
    }

    .trail {
      color: #888 !important;
    }

    .sigil {
      color: #e91e63 !important;
      text-shadow: 0 0 6px #e91e63;
    }

    .glow {
      color: #00f0ff !important;
      text-shadow: 0 0 8px #00f0ff;
    }
  </style>
</head>
<body>
  <div class="grid" id="grid"></div>

  <script>
    const gridEl = document.getElementById('grid');
    const cols = 40;
    const rows = 30;
    const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    const sigils = ['◉', '∆', '⟁', '✶', '⊙'];
    const grid = [];

    const wordList = new Set([
      // 3-letter
      "AND", "ART", "EYE", "SUN", "FUN", "RUN", "YES", "YOU", "SEE", "END",
      "NOW", "AIR", "KEY", "WAY", "OLD", "NEW", "GOD", "ONE", "TOP", "OWN",
      // 4-letter
      "TIME", "LOVE", "SOUL", "MIND", "SIGN", "CALL", "DARK", "FEEL", "HOPE",
      "FREE", "GLOW", "NAME", "TRUE", "OPEN", "STAR", "WISH", "RING", "LIFE",
      // 5-letter
      "LIGHT", "TRUTH", "HEART", "SIGIL", "ALIGN", "GRACE", "FORCE", "SIGHT",
      "INNER", "SPARK", "WORLD", "SENSE", "PEACE", "CYCLE", "SHIFT", "DREAM",
      "GATES", "VIBES", "UNITY", "SHELL", "ECHOE", "FLAME", "ALIVE", "BREAT",
      "VOICE", "NIGHT", "MORPH", "STILL", "CRYPT", "POWER", "DEPTH", "GIVEN"
    ]);

    function randomLetter() {
      return letters.charAt(Math.floor(Math.random() * letters.length));
    }

    function randomSigil() {
      return sigils[Math.floor(Math.random() * sigils.length)];
    }

    function buildGrid() {
      for (let col = 0; col < cols; col++) {
        grid[col] = [];
        for (let row = 0; row < rows; row++) {
          const cell = document.createElement('div');
          cell.className = 'cell';
          cell.innerText = randomLetter();
          grid[col][row] = cell;
          gridEl.appendChild(cell);
        }
      }
    }

    function startDrop(col) {
      const dropLength = Math.floor(Math.random() * 6) + 5;
      let position = 0;

      const interval = setInterval(() => {
        if (position < rows + dropLength) {
          for (let i = 0; i < dropLength; i++) {
            const row = position - i;
            if (row >= 0 && row < rows) {
              const cell = grid[col][row];
              const isLead = i === 0;
              const showSigil = Math.random() < 0.03;

              if (isLead && showSigil) {
                cell.innerText = randomSigil();
                cell.classList.add('sigil');
              } else if (isLead) {
                cell.innerText = randomLetter();
              }

              cell.classList.add('trail');
              setTimeout(() => {
                if (isLead && showSigil) {
                  cell.innerText = randomLetter();
                  cell.classList.remove('sigil');
                }
                cell.classList.remove('trail');
              }, 800);
            }
          }

          // Word detection
          for (let len = 3; len <= 5; len++) {
            const start = position - len + 1;

            // Vertical
            if (start >= 0 && position < rows) {
              let word = '';
              const cells = [];
              for (let i = 0; i < len; i++) {
                word += grid[col][start + i].innerText;
                cells.push(grid[col][start + i]);
              }
              if (wordList.has(word)) {
                cells.forEach(c => c.classList.add('glow'));
                setTimeout(() => cells.forEach(c => c.classList.remove('glow')), 1200);
              }
            }

            // Horizontal
            if (position >= 0 && position < rows) {
              const row = position;
              const maxStart = cols - len;
              for (let hStart = 0; hStart <= maxStart; hStart++) {
                let hWord = '';
                const hCells = [];
                for (let i = 0; i < len; i++) {
                  hWord += grid[hStart + i][row].innerText;
                  hCells.push(grid[hStart + i][row]);
                }
                if (wordList.has(hWord)) {
                  hCells.forEach(c => c.classList.add('glow'));
                  setTimeout(() => hCells.forEach(c => c.classList.remove('glow')), 1200);
                }
              }
            }
          }

          position++;
        } else {
          clearInterval(interval);
        }
      }, 100);
    }

    function triggerRandomDrops() {
      const num = Math.floor(Math.random() * 4) + 2;
      const availableCols = [...Array(cols).keys()];
      for (let i = 0; i < num; i++) {
        const index = Math.floor(Math.random() * availableCols.length);
        const col = availableCols.splice(index, 1)[0];
        startDrop(col);
      }
    }

    // Wait for DOM and grid to finish building
    window.addEventListener("load", () => {
      buildGrid();

      const safe = grid.length === cols && grid[0]?.length === rows;
      if (!safe) {
        console.error("❌ Grid incomplete. Drops not started.");
        return;
      }

      console.log("✅ Grid ready. Starting drops.");
      setInterval(triggerRandomDrops, 400);
    });
  </script>
</body>
</html>
